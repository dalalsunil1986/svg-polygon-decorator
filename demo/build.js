(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.svgCloud = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _decorator = require('../src/decorator');

var _decorator2 = _interopRequireDefault(_decorator);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var form = document.querySelector('.controls');

var render = function render() {
  var cloudEl1 = document.querySelector('#cloud1');
  var cloudEl2 = document.querySelector('#cloud2');

  var radius = parseFloat(form['radius'].value);

  var coordinates = [[10, 120], [180, 120], [230, 180]
  //[230, 180], [180, 120], [10, 120]
  ];

  var cloud1 = (0, _decorator2.default)(coordinates, radius);
  cloudEl1.setAttribute('d', cloud1);

  var coordinates2 = [[20, 300], [180, 300], [200, 330], [190, 360], [140, 420], [70, 380]];

  var cloud2 = (0, _decorator2.default)(coordinates2, radius);
  cloudEl2.setAttribute('d', cloud2);
};

render();

form.addEventListener('change', render);

},{"../src/decorator":2}],2:[function(require,module,exports){
'use strict';

/**
 * Generates svg cloud for polygon
 *
 * @param  {Polygon} poligon
 *
 * @return {Path}
 */

var lineSegmentIntersection = function lineSegmentIntersection(circle, radius, pointA, pointB) {
  var xShift = circle.x;
  var yShift = circle.y;

  //Recet circle to (0,0) coordinate
  circle.x = 0;
  circle.y = 0;
  pointA.x -= xShift;
  pointA.y -= yShift;
  pointB.x -= xShift;
  pointB.y -= yShift;

  var k = (pointB.y - pointA.y) / (pointB.x - pointA.x);
  var b = pointA.y - pointA.x * (pointB.y - pointA.y) / (pointB.x - pointA.x);

  var A = 1 + k * k;
  var B = 2 * k * b;
  var C = b * b - radius * radius;
  var D = B * B - 4 * A * C;

  var x1 = null;
  var x2 = null;
  var y1 = null;
  var y2 = null;

  if (0 < D) {
    console.log('2 points intersects');
    x1 = (-B + Math.sqrt(D)) / (2 * A);
    x2 = (-B - Math.sqrt(D)) / (2 * A);

    if (pointA.x < x1 && pointB.x > x1) {
      return [x1 + xShift, x1 * k + b + yShift];
    }
  } else if (0 === D) {
    console.log('1 point intersect');
    x1 = x2 = (-B + Math.sqrt(D)) / (2 * A);
  } else {
    console.log('0 points intersect');
  }

  return null !== x2 ? [x2 + xShift, x2 * k + b + yShift] : null;
};

var lineLength = function lineLength(line) {
  var pointA = line[0];
  var pointB = line[1];
  var xA = pointA[0];
  var xB = pointB[0];
  var yA = pointA[1];
  var yB = pointB[1];

  return Math.sqrt(Math.pow(xB - xA, 2) + Math.pow(yB - yA, 2));
};

var getIntersection = function getIntersection(line, length) {
  var pointC = null;
  var pointA = line[0];
  var pointB = line[1];
  var xA = pointA[0];
  var xB = pointB[0];
  var yA = pointA[1];
  var yB = pointB[1];
  var delta = void 0;
  var xPoint = void 0;
  var yPoint = void 0;

  var fullLen = lineLength(line);
  var ESP = 0.001;
  if (Math.abs(fullLen - length) < ESP) {
    pointC = pointB;
  } else if (fullLen > length) {
    delta = length / (fullLen - length);
    xPoint = (xA + delta * xB) / (1 + delta);
    yPoint = (yA + delta * yB) / (1 + delta);
    pointC = [xPoint, yPoint];
  }

  return pointC;
};

var cloudALine = function cloudALine(line, radius, nextLine) {
  var lineLength = void 0;
  var pointA = line[0];
  var pointB = line[1];
  var intersection = getIntersection(line, radius * 2);

  var cloud = ['M ' + line[0][0] + ', ' + line[0][1]];
  while (intersection) {
    cloud.push(' A ' + radius + ' ' + radius + ' 0 1 1 ' + intersection[0] + ' ' + intersection[1]);
    line = [intersection, line[1]];
    intersection = getIntersection(line, radius * 2);
  }

  // if (nextLine) {
  //   let nextPoint = lineSegmentIntersection(
  //     {
  //       x: line[0][0] + radius,
  //       y: line[0][1]
  //     },
  //     radius,
  //     {
  //       x: nextLine[0][0],
  //       y: nextLine[0][1]
  //     },
  //     {
  //       x: nextLine[1][0],
  //       y: nextLine[1][1]
  //     }
  //   );
  //
  //   if (null !== nextPoint) {
  //     cloud.push(' A ' + radius + ' ' + radius + ' 0 1 1 ' + nextPoint[0] + ' ' + nextPoint[1]);
  //   }
  // }
  return cloud.join('');
};

var fixRadiusToFitLine = function fixRadiusToFitLine(line, radius) {
  var length = lineLength(line);
  var segments = Math.round(length / (2 * radius) + 0.5);
  var newRadius = length / segments;
  return length / segments / 2;
};

var svgCloud = function svgCloud(poligon, radius) {
  var cloud = 'M ' + poligon[0][0] + ', ' + poligon[0][1];
  var ind = 1;
  var line = void 0;
  var cnt = poligon.length;

  for (; ind < cnt; ++ind) {
    line = [poligon[ind - 1], poligon[ind]];
    cloud += cloudALine(line, fixRadiusToFitLine(line, radius));
  }

  line = [poligon[ind - 1], poligon[0]];
  cloud += cloudALine(line, fixRadiusToFitLine(line, radius));

  return cloud;
};

module.exports = svgCloud;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJkZW1vXFxpbmRleC5qcyIsInNyY1xcZGVjb3JhdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQTs7Ozs7O0FBRUEsSUFBTSxPQUFPLFNBQVMsYUFBVCxDQUF1QixXQUF2QixDQUFiOztBQUVBLElBQU0sU0FBUyxTQUFULE1BQVMsR0FBTTtBQUNuQixNQUFNLFdBQVcsU0FBUyxhQUFULENBQXVCLFNBQXZCLENBQWpCO0FBQ0EsTUFBTSxXQUFXLFNBQVMsYUFBVCxDQUF1QixTQUF2QixDQUFqQjs7QUFFQSxNQUFJLFNBQVMsV0FBVyxLQUFLLFFBQUwsRUFBZSxLQUExQixDQUFiOztBQUVBLE1BQUksY0FBYyxDQUNoQixDQUFDLEVBQUQsRUFBSyxHQUFMLENBRGdCLEVBQ0wsQ0FBQyxHQUFELEVBQU0sR0FBTixDQURLLEVBQ08sQ0FBQyxHQUFELEVBQU0sR0FBTjtBQUN2QjtBQUZnQixHQUFsQjs7QUFLQSxNQUFJLFNBQVMseUJBQVMsV0FBVCxFQUFzQixNQUF0QixDQUFiO0FBQ0EsV0FBUyxZQUFULENBQXNCLEdBQXRCLEVBQTJCLE1BQTNCOztBQUVBLE1BQUksZUFBZSxDQUNqQixDQUFDLEVBQUQsRUFBSyxHQUFMLENBRGlCLEVBQ04sQ0FBQyxHQUFELEVBQU0sR0FBTixDQURNLEVBQ08sQ0FBQyxHQUFELEVBQU0sR0FBTixDQURQLEVBQ21CLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FEbkIsRUFDK0IsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUQvQixFQUMyQyxDQUFDLEVBQUQsRUFBSyxHQUFMLENBRDNDLENBQW5COztBQUlBLE1BQUksU0FBUyx5QkFBUyxZQUFULEVBQXVCLE1BQXZCLENBQWI7QUFDQSxXQUFTLFlBQVQsQ0FBc0IsR0FBdEIsRUFBMkIsTUFBM0I7QUFDRCxDQXBCRDs7QUFzQkE7O0FBRUEsS0FBSyxn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Q0FBRCxFQUFtQixRQUFRLEdBQVIsQ0FBbkIsQ0FBUDtBQUNBLGFBQVMsV0FBVyxJQUFYLEVBQWlCLG1CQUFtQixJQUFuQixFQUF5QixNQUF6QixDQUFqQixDQUFUO0FBQ0Q7O0FBRUQsU0FBTyxDQUFDLFFBQVEsTUFBTSxDQUFkLENBQUQsRUFBbUIsUUFBUSxDQUFSLENBQW5CLENBQVA7QUFDQSxXQUFTLFdBQVcsSUFBWCxFQUFpQixtQkFBbUIsSUFBbkIsRUFBeUIsTUFBekIsQ0FBakIsQ0FBVDs7QUFFQSxTQUFPLEtBQVA7QUFDRCxDQWZEOztBQWlCQSxPQUFPLE9BQVAsR0FBaUIsUUFBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHN2Z0Nsb3VkIGZyb20gJy4uL3NyYy9kZWNvcmF0b3InO1xuXG5jb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyb2xzJyk7XG5cbmNvbnN0IHJlbmRlciA9ICgpID0+IHtcbiAgY29uc3QgY2xvdWRFbDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2xvdWQxJyk7XG4gIGNvbnN0IGNsb3VkRWwyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Nsb3VkMicpO1xuXG4gIGxldCByYWRpdXMgPSBwYXJzZUZsb2F0KGZvcm1bJ3JhZGl1cyddLnZhbHVlKTtcblxuICB2YXIgY29vcmRpbmF0ZXMgPSBbXG4gICAgWzEwLCAxMjBdLCBbMTgwLCAxMjBdLCBbMjMwLCAxODBdXG4gICAgLy9bMjMwLCAxODBdLCBbMTgwLCAxMjBdLCBbMTAsIDEyMF1cbiAgXTtcblxuICBsZXQgY2xvdWQxID0gc3ZnQ2xvdWQoY29vcmRpbmF0ZXMsIHJhZGl1cyk7XG4gIGNsb3VkRWwxLnNldEF0dHJpYnV0ZSgnZCcsIGNsb3VkMSk7XG5cbiAgbGV0IGNvb3JkaW5hdGVzMiA9IFtcbiAgICBbMjAsIDMwMF0sIFsxODAsIDMwMF0sICBbMjAwLCAzMzBdLCBbMTkwLCAzNjBdLCBbMTQwLCA0MjBdLCBbNzAsIDM4MF1cbiAgXTtcblxuICBsZXQgY2xvdWQyID0gc3ZnQ2xvdWQoY29vcmRpbmF0ZXMyLCByYWRpdXMpO1xuICBjbG91ZEVsMi5zZXRBdHRyaWJ1dGUoJ2QnLCBjbG91ZDIpO1xufVxuXG5yZW5kZXIoKTtcblxuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCByZW5kZXIpO1xuIiwiXG4vKipcbiAqIEdlbmVyYXRlcyBzdmcgY2xvdWQgZm9yIHBvbHlnb25cbiAqXG4gKiBAcGFyYW0gIHtQb2x5Z29ufSBwb2xpZ29uXG4gKlxuICogQHJldHVybiB7UGF0aH1cbiAqL1xuXG5sZXQgbGluZVNlZ21lbnRJbnRlcnNlY3Rpb24gPSAoY2lyY2xlLCByYWRpdXMsIHBvaW50QSwgcG9pbnRCKSA9PiB7XG4gIGNvbnN0IHhTaGlmdCA9IGNpcmNsZS54O1xuICBjb25zdCB5U2hpZnQgPSBjaXJjbGUueTtcblxuICAvL1JlY2V0IGNpcmNsZSB0byAoMCwwKSBjb29yZGluYXRlXG4gIGNpcmNsZS54ID0gMDtcbiAgY2lyY2xlLnkgPSAwO1xuICBwb2ludEEueCAtPSB4U2hpZnQ7XG4gIHBvaW50QS55IC09IHlTaGlmdDtcbiAgcG9pbnRCLnggLT0geFNoaWZ0O1xuICBwb2ludEIueSAtPSB5U2hpZnQ7XG5cbiAgbGV0IGsgPSAocG9pbnRCLnkgLSBwb2ludEEueSkgLyAocG9pbnRCLnggLSBwb2ludEEueCk7XG4gIGxldCBiID0gcG9pbnRBLnkgLSBwb2ludEEueCAqIChwb2ludEIueSAtIHBvaW50QS55KSAvIChwb2ludEIueCAtIHBvaW50QS54KTtcblxuICBjb25zdCBBID0gMSArIGsgKiBrO1xuICBjb25zdCBCID0gMiAqIGsgKiBiO1xuICBjb25zdCBDID0gYiAqIGIgLSByYWRpdXMgKiByYWRpdXM7XG4gIGNvbnN0IEQgPSBCICogQiAtIDQgKiBBICogQztcblxuICBsZXQgeDEgPSBudWxsO1xuICBsZXQgeDIgPSBudWxsO1xuICBsZXQgeTEgPSBudWxsO1xuICBsZXQgeTIgPSBudWxsO1xuXG4gIGlmICgwIDwgRCkge1xuICAgIGNvbnNvbGUubG9nKCcyIHBvaW50cyBpbnRlcnNlY3RzJyk7XG4gICAgeDEgPSAoLUIgKyBNYXRoLnNxcnQoRCkpIC8gKDIgKiBBKTtcbiAgICB4MiA9ICgtQiAtIE1hdGguc3FydChEKSkgLyAoMiAqIEEpO1xuXG4gICAgaWYgKHBvaW50QS54IDwgeDEgJiYgcG9pbnRCLnggPiB4MSkge1xuICAgICAgcmV0dXJuIFt4MSArIHhTaGlmdCwgKHgxICogayAgKyBiKSArIHlTaGlmdF07XG4gICAgfVxuICB9IGVsc2UgaWYgKDAgPT09IEQpIHtcbiAgICBjb25zb2xlLmxvZygnMSBwb2ludCBpbnRlcnNlY3QnKTtcbiAgICB4MSA9IHgyID0gKC1CICsgTWF0aC5zcXJ0KEQpKSAvICgyICogQSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coJzAgcG9pbnRzIGludGVyc2VjdCcpO1xuICB9XG5cbiAgcmV0dXJuIG51bGwgIT09IHgyID8gW3gyICsgeFNoaWZ0LCAoeDIgKiBrICArIGIpICsgeVNoaWZ0XSA6IG51bGw7XG59O1xuXG5cbmxldCBsaW5lTGVuZ3RoID0gKGxpbmUpID0+IHtcbiAgbGV0IHBvaW50QSA9IGxpbmVbMF07XG4gIGxldCBwb2ludEIgPSBsaW5lWzFdO1xuICBsZXQgeEEgPSBwb2ludEFbMF07XG4gIGxldCB4QiA9IHBvaW50QlswXTtcbiAgbGV0IHlBID0gcG9pbnRBWzFdO1xuICBsZXQgeUIgPSBwb2ludEJbMV07XG5cbiAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdygoeEIgLSB4QSksIDIpICsgTWF0aC5wb3coKHlCIC0geUEpLCAyKSk7XG59O1xuXG5cbmxldCBnZXRJbnRlcnNlY3Rpb24gPSAobGluZSwgbGVuZ3RoKSA9PiB7XG4gIGxldCBwb2ludEMgPSBudWxsO1xuICBsZXQgcG9pbnRBID0gbGluZVswXTtcbiAgbGV0IHBvaW50QiA9IGxpbmVbMV07XG4gIGxldCB4QSA9IHBvaW50QVswXTtcbiAgbGV0IHhCID0gcG9pbnRCWzBdO1xuICBsZXQgeUEgPSBwb2ludEFbMV07XG4gIGxldCB5QiA9IHBvaW50QlsxXTtcbiAgbGV0IGRlbHRhO1xuICBsZXQgeFBvaW50O1xuICBsZXQgeVBvaW50O1xuXG4gIGxldCBmdWxsTGVuID0gbGluZUxlbmd0aChsaW5lKTtcbiAgY29uc3QgRVNQID0gMC4wMDE7XG4gIGlmIChNYXRoLmFicyhmdWxsTGVuIC0gbGVuZ3RoKSA8IEVTUCkge1xuICAgIHBvaW50QyA9IHBvaW50QjtcbiAgfSBlbHNlIGlmIChmdWxsTGVuID4gbGVuZ3RoKSB7XG4gICAgZGVsdGEgPSBsZW5ndGggLyAoZnVsbExlbiAtIGxlbmd0aClcbiAgICB4UG9pbnQgPSAoeEEgKyBkZWx0YSAqIHhCKSAvICgxICsgZGVsdGEpO1xuICAgIHlQb2ludCA9ICh5QSArIGRlbHRhICogeUIpIC8gKDEgKyBkZWx0YSk7XG4gICAgcG9pbnRDID0gW3hQb2ludCwgeVBvaW50XTtcbiAgfVxuXG4gIHJldHVybiBwb2ludEM7XG59O1xuXG5sZXQgY2xvdWRBTGluZSA9IChsaW5lLCByYWRpdXMsIG5leHRMaW5lKSA9PiB7XG4gIGxldCBsaW5lTGVuZ3RoO1xuICBsZXQgcG9pbnRBID0gbGluZVswXTtcbiAgbGV0IHBvaW50QiA9IGxpbmVbMV07XG4gIGxldCBpbnRlcnNlY3Rpb24gPSBnZXRJbnRlcnNlY3Rpb24obGluZSwgcmFkaXVzICogMik7XG5cbiAgbGV0IGNsb3VkID0gWydNICcgKyBsaW5lWzBdWzBdICsgJywgJyArIGxpbmVbMF1bMV1dO1xuICB3aGlsZSAoaW50ZXJzZWN0aW9uKSB7XG4gICAgY2xvdWQucHVzaCgnIEEgJyArIHJhZGl1cyArICcgJyArIHJhZGl1cyArICcgMCAxIDEgJyArIGludGVyc2VjdGlvblswXSArICcgJyArIGludGVyc2VjdGlvblsxXSk7XG4gICAgbGluZSA9IFtpbnRlcnNlY3Rpb24sIGxpbmVbMV1dO1xuICAgIGludGVyc2VjdGlvbiA9IGdldEludGVyc2VjdGlvbihsaW5lLCByYWRpdXMgKiAyKTtcbiAgfVxuXG5cbiAgLy8gaWYgKG5leHRMaW5lKSB7XG4gIC8vICAgbGV0IG5leHRQb2ludCA9IGxpbmVTZWdtZW50SW50ZXJzZWN0aW9uKFxuICAvLyAgICAge1xuICAvLyAgICAgICB4OiBsaW5lWzBdWzBdICsgcmFkaXVzLFxuICAvLyAgICAgICB5OiBsaW5lWzBdWzFdXG4gIC8vICAgICB9LFxuICAvLyAgICAgcmFkaXVzLFxuICAvLyAgICAge1xuICAvLyAgICAgICB4OiBuZXh0TGluZVswXVswXSxcbiAgLy8gICAgICAgeTogbmV4dExpbmVbMF1bMV1cbiAgLy8gICAgIH0sXG4gIC8vICAgICB7XG4gIC8vICAgICAgIHg6IG5leHRMaW5lWzFdWzBdLFxuICAvLyAgICAgICB5OiBuZXh0TGluZVsxXVsxXVxuICAvLyAgICAgfVxuICAvLyAgICk7XG4gIC8vXG4gIC8vICAgaWYgKG51bGwgIT09IG5leHRQb2ludCkge1xuICAvLyAgICAgY2xvdWQucHVzaCgnIEEgJyArIHJhZGl1cyArICcgJyArIHJhZGl1cyArICcgMCAxIDEgJyArIG5leHRQb2ludFswXSArICcgJyArIG5leHRQb2ludFsxXSk7XG4gIC8vICAgfVxuICAvLyB9XG4gIHJldHVybiBjbG91ZC5qb2luKCcnKTtcbn07XG5cblxudmFyIGZpeFJhZGl1c1RvRml0TGluZSA9IChsaW5lLCByYWRpdXMpID0+IHtcbiAgY29uc3QgbGVuZ3RoID0gbGluZUxlbmd0aChsaW5lKTtcbiAgbGV0IHNlZ21lbnRzID0gTWF0aC5yb3VuZChsZW5ndGggLyAoMiAqIHJhZGl1cykgKyAwLjUpO1xuICBjb25zdCBuZXdSYWRpdXMgPSBsZW5ndGggLyBzZWdtZW50cztcbiAgcmV0dXJuIGxlbmd0aCAvIHNlZ21lbnRzIC8gMjtcbn07XG5cblxubGV0IHN2Z0Nsb3VkID0gKHBvbGlnb24sIHJhZGl1cykgPT4ge1xuICBsZXQgY2xvdWQgPSAnTSAnICsgcG9saWdvblswXVswXSArICcsICcgKyBwb2xpZ29uWzBdWzFdO1xuICBsZXQgaW5kID0gMTtcbiAgbGV0IGxpbmU7XG4gIGNvbnN0IGNudCA9IHBvbGlnb24ubGVuZ3RoO1xuXG4gIGZvciAoOyBpbmQgPCBjbnQ7ICsrIGluZCkge1xuICAgIGxpbmUgPSBbcG9saWdvbltpbmQgLSAxXSwgcG9saWdvbltpbmRdXTtcbiAgICBjbG91ZCArPSBjbG91ZEFMaW5lKGxpbmUsIGZpeFJhZGl1c1RvRml0TGluZShsaW5lLCByYWRpdXMpKTtcbiAgfVxuXG4gIGxpbmUgPSBbcG9saWdvbltpbmQgLSAxXSwgcG9saWdvblswXV07XG4gIGNsb3VkICs9IGNsb3VkQUxpbmUobGluZSwgZml4UmFkaXVzVG9GaXRMaW5lKGxpbmUsIHJhZGl1cykpO1xuXG4gIHJldHVybiBjbG91ZDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gc3ZnQ2xvdWQ7XG4iXX0=
