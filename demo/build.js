(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.svgCloud = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _decorator = require('../src/decorator');

var _decorator2 = _interopRequireDefault(_decorator);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var cloudEl1 = document.querySelector('#cloud1');
var cloudEl2 = document.querySelector('#cloud2');

var radius = 8;

var coordinates = [[10, 120], [180, 120], [230, 180]];

var cloud1 = (0, _decorator2.default)(coordinates, radius);
cloudEl1.setAttribute('d', cloud1);

var coordinates2 = [[20, 300], [180, 300], [200, 330], [190, 360], [140, 420], [70, 380]];

var cloud2 = (0, _decorator2.default)(coordinates2, radius);
cloudEl2.setAttribute('d', cloud2);

},{"../src/decorator":2}],2:[function(require,module,exports){
'use strict';

/**
 * Generates svg cloud for polygon
 *
 * @param  {Polygon} poligon
 *
 * @return {Path}
 */

var lineSegmentIntersection = function lineSegmentIntersection(circle, radius, pointA, pointB) {
  var xShift = circle.x;
  var yShift = circle.y;

  //Recet circle to (0,0) coordinate
  circle.x = 0;
  circle.y = 0;
  pointA.x -= xShift;
  pointA.y -= yShift;
  pointB.x -= xShift;
  pointB.y -= yShift;

  var k = (pointB.y - pointA.y) / (pointB.x - pointA.x);
  var b = pointA.y - pointA.x * (pointB.y - pointA.y) / (pointB.x - pointA.x);

  var A = 1 + k * k;
  var B = 2 * k * b;
  var C = b * b - radius * radius;
  var D = B * B - 4 * A * C;

  var x1 = null;
  var x2 = null;
  var y1 = null;
  var y2 = null;

  if (0 < D) {
    console.log('2 points intersects');
    x1 = (-B + Math.sqrt(D)) / (2 * A);
    x2 = (-B - Math.sqrt(D)) / (2 * A);

    if (pointA.x < x1 && pointB.x > x1) {
      return [x1 + xShift, x1 * k + b + yShift];
    }
  } else if (0 === D) {
    console.log('1 point intersect');
    x1 = x2 = (-B + Math.sqrt(D)) / (2 * A);
  } else {
    console.log('0 points intersect');
  }

  return null !== x2 ? [x2 + xShift, x2 * k + b + yShift] : null;
};

var lineLength = function lineLength(line) {
  var pointA = line[0];
  var pointB = line[1];
  var xA = pointA[0];
  var xB = pointB[0];
  var yA = pointA[1];
  var yB = pointB[1];

  return Math.sqrt(Math.pow(xB - xA, 2) + Math.pow(yB - yA, 2));
};

var getIntersection = function getIntersection(line, length) {
  var pointC = null;
  var pointA = line[0];
  var pointB = line[1];
  var xA = pointA[0];
  var xB = pointB[0];
  var yA = pointA[1];
  var yB = pointB[1];
  var delta = void 0;
  var xPoint = void 0;
  var yPoint = void 0;

  var fullLen = lineLength(line);
  var ESP = 0.001;
  if (Math.abs(fullLen - length) < ESP) {
    pointC = pointB;
  } else if (fullLen > length) {
    delta = length / (fullLen - length);
    xPoint = (xA + delta * xB) / (1 + delta);
    yPoint = (yA + delta * yB) / (1 + delta);
    pointC = [xPoint, yPoint];
  }

  return pointC;
};

var cloudALine = function cloudALine(line, radius, nextLine) {
  var lineLength = void 0;
  var pointA = line[0];
  var pointB = line[1];
  var intersection = getIntersection(line, radius * 2);

  var cloud = ['M ' + line[0][0] + ', ' + line[0][1]];
  while (intersection) {
    cloud.push(' A ' + radius + ' ' + radius + ' 0 1 1 ' + intersection[0] + ' ' + intersection[1]);
    line = [intersection, line[1]];
    intersection = getIntersection(line, radius * 2);
  }

  // if (nextLine) {
  //   let nextPoint = lineSegmentIntersection(
  //     {
  //       x: line[0][0] + radius,
  //       y: line[0][1]
  //     },
  //     radius,
  //     {
  //       x: nextLine[0][0],
  //       y: nextLine[0][1]
  //     },
  //     {
  //       x: nextLine[1][0],
  //       y: nextLine[1][1]
  //     }
  //   );
  //
  //   if (null !== nextPoint) {
  //     cloud.push(' A ' + radius + ' ' + radius + ' 0 1 1 ' + nextPoint[0] + ' ' + nextPoint[1]);
  //   }
  // }
  return cloud.join('');
};

var fixRadiusToFitLine = function fixRadiusToFitLine(line, radius) {
  var length = lineLength(line);
  var segments = Math.round(length / (2 * radius) + 0.5);
  var newRadius = length / segments;
  return length / segments / 2;
};

var svgCloud = function svgCloud(poligon, radius) {
  var cloud = 'M ' + poligon[0][0] + ', ' + poligon[0][1];
  var ind = 1;
  var line = void 0;
  var cnt = poligon.length;

  for (; ind < cnt; ++ind) {
    line = [poligon[ind - 1], poligon[ind]];
    cloud += cloudALine(line, fixRadiusToFitLine(line, radius));
  }

  line = [poligon[ind - 1], poligon[0]];
  cloud += cloudALine(line, fixRadiusToFitLine(line, radius));

  return cloud;
};

module.exports = svgCloud;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJkZW1vL2luZGV4LmpzIiwic3JjL2RlY29yYXRvci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7Ozs7OztBQUVBLElBQU0sV0FBVyxTQUFTLGFBQVQsQ0FBdUIsU0FBdkIsQ0FBakI7QUFDQSxJQUFNLFdBQVcsU0FBUyxhQUFULENBQXVCLFNBQXZCLENBQWpCOztBQUVBLElBQU0sU0FBUyxDQUFmOztBQUVBLElBQUksY0FBYyxDQUNoQixDQUFDLEVBQUQsRUFBSyxHQUFMLENBRGdCLEVBQ0wsQ0FBQyxHQUFELEVBQU0sR0FBTixDQURLLEVBQ08sQ0FBQyxHQUFELEVBQU0sR0FBTixDQURQLENBQWxCOztBQUlBLElBQUksU0FBUyx5QkFBUyxXQUFULEVBQXNCLE1BQXRCLENBQWI7QUFDQSxTQUFTLFlBQVQsQ0FBc0IsR0FBdEIsRUFBMkIsTUFBM0I7O0FBRUEsSUFBSSxlQUFlLENBQ2pCLENBQUMsRUFBRCxFQUFLLEdBQUwsQ0FEaUIsRUFDTixDQUFDLEdBQUQsRUFBTSxHQUFOLENBRE0sRUFDTyxDQUFDLEdBQUQsRUFBTSxHQUFOLENBRFAsRUFDbUIsQ0FBQyxHQUFELEVBQU0sR0FBTixDQURuQixFQUMrQixDQUFDLEdBQUQsRUFBTSxHQUFOLENBRC9CLEVBQzJDLENBQUMsRUFBRCxFQUFLLEdBQUwsQ0FEM0MsQ0FBbkI7O0FBSUEsSUFBSSxTQUFTLHlCQUFTLFlBQVQsRUFBdUIsTUFBdkIsQ0FBYjtBQUNBLFNBQVMsWUFBVCxDQUFzQixHQUF0QixFQUEyQixNQUEzQjs7Ozs7QUNsQkE7Ozs7Ozs7O0FBUUEsSUFBSSwwQkFBMEIsU0FBMUIsdUJBQTBCLENBQUMsTUFBRCxFQUFTLE1BQVQsRUFBaUIsTUFBakIsRUFBeUIsTUFBekIsRUFBb0M7QUFDaEUsTUFBTSxTQUFTLE9BQU8sQ0FBdEI7QUFDQSxNQUFNLFNBQVMs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QUFTLFdBQVcsSUFBWCxFQUFpQixtQkFBbUIsSUFBbkIsRUFBeUIsTUFBekIsQ0FBakIsQ0FBVDs7QUFFQSxTQUFPLEtBQVA7QUFDRCxDQWZEOztBQWlCQSxPQUFPLE9BQVAsR0FBaUIsUUFBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHN2Z0Nsb3VkIGZyb20gJy4uL3NyYy9kZWNvcmF0b3InO1xuXG5jb25zdCBjbG91ZEVsMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjbG91ZDEnKTtcbmNvbnN0IGNsb3VkRWwyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Nsb3VkMicpO1xuXG5jb25zdCByYWRpdXMgPSA4O1xuXG52YXIgY29vcmRpbmF0ZXMgPSBbXG4gIFsxMCwgMTIwXSwgWzE4MCwgMTIwXSwgWzIzMCwgMTgwXVxuXTtcblxubGV0IGNsb3VkMSA9IHN2Z0Nsb3VkKGNvb3JkaW5hdGVzLCByYWRpdXMpO1xuY2xvdWRFbDEuc2V0QXR0cmlidXRlKCdkJywgY2xvdWQxKTtcblxubGV0IGNvb3JkaW5hdGVzMiA9IFtcbiAgWzIwLCAzMDBdLCBbMTgwLCAzMDBdLCAgWzIwMCwgMzMwXSwgWzE5MCwgMzYwXSwgWzE0MCwgNDIwXSwgWzcwLCAzODBdXG5dO1xuXG5sZXQgY2xvdWQyID0gc3ZnQ2xvdWQoY29vcmRpbmF0ZXMyLCByYWRpdXMpO1xuY2xvdWRFbDIuc2V0QXR0cmlidXRlKCdkJywgY2xvdWQyKTtcbiIsIlxuLyoqXG4gKiBHZW5lcmF0ZXMgc3ZnIGNsb3VkIGZvciBwb2x5Z29uXG4gKlxuICogQHBhcmFtICB7UG9seWdvbn0gcG9saWdvblxuICpcbiAqIEByZXR1cm4ge1BhdGh9XG4gKi9cblxubGV0IGxpbmVTZWdtZW50SW50ZXJzZWN0aW9uID0gKGNpcmNsZSwgcmFkaXVzLCBwb2ludEEsIHBvaW50QikgPT4ge1xuICBjb25zdCB4U2hpZnQgPSBjaXJjbGUueDtcbiAgY29uc3QgeVNoaWZ0ID0gY2lyY2xlLnk7XG5cbiAgLy9SZWNldCBjaXJjbGUgdG8gKDAsMCkgY29vcmRpbmF0ZVxuICBjaXJjbGUueCA9IDA7XG4gIGNpcmNsZS55ID0gMDtcbiAgcG9pbnRBLnggLT0geFNoaWZ0O1xuICBwb2ludEEueSAtPSB5U2hpZnQ7XG4gIHBvaW50Qi54IC09IHhTaGlmdDtcbiAgcG9pbnRCLnkgLT0geVNoaWZ0O1xuXG4gIGxldCBrID0gKHBvaW50Qi55IC0gcG9pbnRBLnkpIC8gKHBvaW50Qi54IC0gcG9pbnRBLngpO1xuICBsZXQgYiA9IHBvaW50QS55IC0gcG9pbnRBLnggKiAocG9pbnRCLnkgLSBwb2ludEEueSkgLyAocG9pbnRCLnggLSBwb2ludEEueCk7XG5cbiAgY29uc3QgQSA9IDEgKyBrICogaztcbiAgY29uc3QgQiA9IDIgKiBrICogYjtcbiAgY29uc3QgQyA9IGIgKiBiIC0gcmFkaXVzICogcmFkaXVzO1xuICBjb25zdCBEID0gQiAqIEIgLSA0ICogQSAqIEM7XG5cbiAgbGV0IHgxID0gbnVsbDtcbiAgbGV0IHgyID0gbnVsbDtcbiAgbGV0IHkxID0gbnVsbDtcbiAgbGV0IHkyID0gbnVsbDtcblxuICBpZiAoMCA8IEQpIHtcbiAgICBjb25zb2xlLmxvZygnMiBwb2ludHMgaW50ZXJzZWN0cycpO1xuICAgIHgxID0gKC1CICsgTWF0aC5zcXJ0KEQpKSAvICgyICogQSk7XG4gICAgeDIgPSAoLUIgLSBNYXRoLnNxcnQoRCkpIC8gKDIgKiBBKTtcblxuICAgIGlmIChwb2ludEEueCA8IHgxICYmIHBvaW50Qi54ID4geDEpIHtcbiAgICAgIHJldHVybiBbeDEgKyB4U2hpZnQsICh4MSAqIGsgICsgYikgKyB5U2hpZnRdO1xuICAgIH1cbiAgfSBlbHNlIGlmICgwID09PSBEKSB7XG4gICAgY29uc29sZS5sb2coJzEgcG9pbnQgaW50ZXJzZWN0Jyk7XG4gICAgeDEgPSB4MiA9ICgtQiArIE1hdGguc3FydChEKSkgLyAoMiAqIEEpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKCcwIHBvaW50cyBpbnRlcnNlY3QnKTtcbiAgfVxuXG4gIHJldHVybiBudWxsICE9PSB4MiA/IFt4MiArIHhTaGlmdCwgKHgyICogayAgKyBiKSArIHlTaGlmdF0gOiBudWxsO1xufTtcblxuXG5sZXQgbGluZUxlbmd0aCA9IChsaW5lKSA9PiB7XG4gIGxldCBwb2ludEEgPSBsaW5lWzBdO1xuICBsZXQgcG9pbnRCID0gbGluZVsxXTtcbiAgbGV0IHhBID0gcG9pbnRBWzBdO1xuICBsZXQgeEIgPSBwb2ludEJbMF07XG4gIGxldCB5QSA9IHBvaW50QVsxXTtcbiAgbGV0IHlCID0gcG9pbnRCWzFdO1xuXG4gIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coKHhCIC0geEEpLCAyKSArIE1hdGgucG93KCh5QiAtIHlBKSwgMikpO1xufTtcblxuXG5sZXQgZ2V0SW50ZXJzZWN0aW9uID0gKGxpbmUsIGxlbmd0aCkgPT4ge1xuICBsZXQgcG9pbnRDID0gbnVsbDtcbiAgbGV0IHBvaW50QSA9IGxpbmVbMF07XG4gIGxldCBwb2ludEIgPSBsaW5lWzFdO1xuICBsZXQgeEEgPSBwb2ludEFbMF07XG4gIGxldCB4QiA9IHBvaW50QlswXTtcbiAgbGV0IHlBID0gcG9pbnRBWzFdO1xuICBsZXQgeUIgPSBwb2ludEJbMV07XG4gIGxldCBkZWx0YTtcbiAgbGV0IHhQb2ludDtcbiAgbGV0IHlQb2ludDtcblxuICBsZXQgZnVsbExlbiA9IGxpbmVMZW5ndGgobGluZSk7XG4gIGNvbnN0IEVTUCA9IDAuMDAxO1xuICBpZiAoTWF0aC5hYnMoZnVsbExlbiAtIGxlbmd0aCkgPCBFU1ApIHtcbiAgICBwb2ludEMgPSBwb2ludEI7XG4gIH0gZWxzZSBpZiAoZnVsbExlbiA+IGxlbmd0aCkge1xuICAgIGRlbHRhID0gbGVuZ3RoIC8gKGZ1bGxMZW4gLSBsZW5ndGgpXG4gICAgeFBvaW50ID0gKHhBICsgZGVsdGEgKiB4QikgLyAoMSArIGRlbHRhKTtcbiAgICB5UG9pbnQgPSAoeUEgKyBkZWx0YSAqIHlCKSAvICgxICsgZGVsdGEpO1xuICAgIHBvaW50QyA9IFt4UG9pbnQsIHlQb2ludF07XG4gIH1cblxuICByZXR1cm4gcG9pbnRDO1xufTtcblxubGV0IGNsb3VkQUxpbmUgPSAobGluZSwgcmFkaXVzLCBuZXh0TGluZSkgPT4ge1xuICBsZXQgbGluZUxlbmd0aDtcbiAgbGV0IHBvaW50QSA9IGxpbmVbMF07XG4gIGxldCBwb2ludEIgPSBsaW5lWzFdO1xuICBsZXQgaW50ZXJzZWN0aW9uID0gZ2V0SW50ZXJzZWN0aW9uKGxpbmUsIHJhZGl1cyAqIDIpO1xuXG4gIGxldCBjbG91ZCA9IFsnTSAnICsgbGluZVswXVswXSArICcsICcgKyBsaW5lWzBdWzFdXTtcbiAgd2hpbGUgKGludGVyc2VjdGlvbikge1xuICAgIGNsb3VkLnB1c2goJyBBICcgKyByYWRpdXMgKyAnICcgKyByYWRpdXMgKyAnIDAgMSAxICcgKyBpbnRlcnNlY3Rpb25bMF0gKyAnICcgKyBpbnRlcnNlY3Rpb25bMV0pO1xuICAgIGxpbmUgPSBbaW50ZXJzZWN0aW9uLCBsaW5lWzFdXTtcbiAgICBpbnRlcnNlY3Rpb24gPSBnZXRJbnRlcnNlY3Rpb24obGluZSwgcmFkaXVzICogMik7XG4gIH1cblxuXG4gIC8vIGlmIChuZXh0TGluZSkge1xuICAvLyAgIGxldCBuZXh0UG9pbnQgPSBsaW5lU2VnbWVudEludGVyc2VjdGlvbihcbiAgLy8gICAgIHtcbiAgLy8gICAgICAgeDogbGluZVswXVswXSArIHJhZGl1cyxcbiAgLy8gICAgICAgeTogbGluZVswXVsxXVxuICAvLyAgICAgfSxcbiAgLy8gICAgIHJhZGl1cyxcbiAgLy8gICAgIHtcbiAgLy8gICAgICAgeDogbmV4dExpbmVbMF1bMF0sXG4gIC8vICAgICAgIHk6IG5leHRMaW5lWzBdWzFdXG4gIC8vICAgICB9LFxuICAvLyAgICAge1xuICAvLyAgICAgICB4OiBuZXh0TGluZVsxXVswXSxcbiAgLy8gICAgICAgeTogbmV4dExpbmVbMV1bMV1cbiAgLy8gICAgIH1cbiAgLy8gICApO1xuICAvL1xuICAvLyAgIGlmIChudWxsICE9PSBuZXh0UG9pbnQpIHtcbiAgLy8gICAgIGNsb3VkLnB1c2goJyBBICcgKyByYWRpdXMgKyAnICcgKyByYWRpdXMgKyAnIDAgMSAxICcgKyBuZXh0UG9pbnRbMF0gKyAnICcgKyBuZXh0UG9pbnRbMV0pO1xuICAvLyAgIH1cbiAgLy8gfVxuICByZXR1cm4gY2xvdWQuam9pbignJyk7XG59O1xuXG5cbnZhciBmaXhSYWRpdXNUb0ZpdExpbmUgPSAobGluZSwgcmFkaXVzKSA9PiB7XG4gIGNvbnN0IGxlbmd0aCA9IGxpbmVMZW5ndGgobGluZSk7XG4gIGxldCBzZWdtZW50cyA9IE1hdGgucm91bmQobGVuZ3RoIC8gKDIgKiByYWRpdXMpICsgMC41KTtcbiAgY29uc3QgbmV3UmFkaXVzID0gbGVuZ3RoIC8gc2VnbWVudHM7XG4gIHJldHVybiBsZW5ndGggLyBzZWdtZW50cyAvIDI7XG59O1xuXG5cbmxldCBzdmdDbG91ZCA9IChwb2xpZ29uLCByYWRpdXMpID0+IHtcbiAgbGV0IGNsb3VkID0gJ00gJyArIHBvbGlnb25bMF1bMF0gKyAnLCAnICsgcG9saWdvblswXVsxXTtcbiAgbGV0IGluZCA9IDE7XG4gIGxldCBsaW5lO1xuICBjb25zdCBjbnQgPSBwb2xpZ29uLmxlbmd0aDtcblxuICBmb3IgKDsgaW5kIDwgY250OyArKyBpbmQpIHtcbiAgICBsaW5lID0gW3BvbGlnb25baW5kIC0gMV0sIHBvbGlnb25baW5kXV07XG4gICAgY2xvdWQgKz0gY2xvdWRBTGluZShsaW5lLCBmaXhSYWRpdXNUb0ZpdExpbmUobGluZSwgcmFkaXVzKSk7XG4gIH1cblxuICBsaW5lID0gW3BvbGlnb25baW5kIC0gMV0sIHBvbGlnb25bMF1dO1xuICBjbG91ZCArPSBjbG91ZEFMaW5lKGxpbmUsIGZpeFJhZGl1c1RvRml0TGluZShsaW5lLCByYWRpdXMpKTtcblxuICByZXR1cm4gY2xvdWQ7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHN2Z0Nsb3VkO1xuIl19
