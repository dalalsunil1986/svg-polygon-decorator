(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.svgCloud = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _decorator = require('../src/decorator');

var _decorator2 = _interopRequireDefault(_decorator);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var form = document.querySelector('.controls');
var clouds = [{
  selector: '#cloud1',
  coords: [[10, 120], [180, 120], [230, 180]]
}, {
  selector: '#cloud2',
  coords: [[20, 300], [180, 300], [200, 330], [190, 360], [140, 420], [70, 380]]
}, {
  selector: '#cloud3',
  coords: [[460, 120], [290, 120], [240, 180]]
}, {
  selector: '#cloud4',
  coords: [[450, 300], [290, 300], [270, 330], [280, 360], [330, 420], [400, 380]]
}, {
  selector: '#cloud_l1',
  coords: [[10, 10], [230, 10]]
}, {
  selector: '#cloud_l2',
  coords: [[450, 10], [240, 10]]
}];

var render = function render() {
  var elem = void 0;
  var cloud = void 0;
  var radius = parseFloat(form.radius.value);
  var closed = form.closed.checked;
  var inward = form.inward.checked;
  var swapping = form.swapping.checked;

  for (var ind = 0, cnt = clouds.length; ind < cnt; ++ind) {
    elem = document.querySelector(clouds[ind].selector);
    cloud = (0, _decorator2.default)(clouds[ind].coords, radius, closed, inward, swapping);
    elem.setAttribute('d', cloud);
  }
};

form.addEventListener('change', render);
render();

},{"../src/decorator":2}],2:[function(require,module,exports){
'use strict';

/**
 * Generates svg cloud for polygon
 *
 * @param  {Polygon} polygon
 *
 * @return {SVG Path}
 */

var X = 0;
var Y = 1;
var FLOAT_PRECISE = 0.000001;

var lineLength = function lineLength(line) {
  var pointA = line[0];
  var pointB = line[1];

  return Math.sqrt(Math.pow(pointB[X] - pointA[X], 2) + Math.pow(pointB[Y] - pointA[Y], 2));
};

var getIntersection = function getIntersection(line, length) {
  var pointC = null;
  var pointA = line[0];
  var pointB = line[1];
  var delta = void 0;
  var xPoint = void 0;
  var yPoint = void 0;
  var fullLen = lineLength(line);

  if (Math.abs(fullLen - length) < FLOAT_PRECISE) {
    pointC = pointB;
  } else if (fullLen > length) {
    delta = length / (fullLen - length);
    xPoint = (pointA[X] + delta * pointB[X]) / (1 + delta);
    yPoint = (pointA[Y] + delta * pointB[Y]) / (1 + delta);
    pointC = [xPoint, yPoint];
  }

  return pointC;
};

var cloudALine = function cloudALine(line, radius, inward, swapping) {
  var point = getIntersection(line, radius * 2);
  var remainingLine = line;
  var arc = void 0;
  var cloud = ['M' + line[0][X] + ',' + line[0][Y]];
  var sweep = true === inward ? 0 : 1;
  var lArc = true === inward ? 0 : 1;

  while (point) {
    arc = ' A' + radius + ',' + radius + ' 0 ' + lArc + ',' + sweep + ' ' + point[X] + ',' + point[Y];
    cloud.push(arc);
    remainingLine = [point, remainingLine[1]];
    point = getIntersection(remainingLine, radius * 2);
    if (true === swapping) {
      sweep ^= 1;
      lArc ^= 1;
    }
  }

  return cloud.join('');
};

var fixRadiusToFitLine = function fixRadiusToFitLine(line, radius) {
  var length = lineLength(line);
  var segments = Math.round(length / (2 * radius) + 0.5);

  return 0 < length ? length / segments / 2 : radius;
};

var svgCloud = function svgCloud(polyline, radius, closed, inward, swapping) {
  var cloud = [];
  var ind = 1;
  var line = void 0;
  var r = 0 < radius ? radius : 1;
  var cnt = polyline.length;
  var fittedRadius = void 0;

  for (; ind < cnt; ++ind) {
    line = [polyline[ind - 1], polyline[ind]];
    fittedRadius = fixRadiusToFitLine(line, r);
    if (true === swapping) {
      fittedRadius /= 2;
    }
    cloud.push(cloudALine(line, fittedRadius, inward, swapping));
  }

  // close to get polygon
  if (true === closed && 1 < cnt) {
    line = [polyline[ind - 1], polyline[0]];
    fittedRadius = fixRadiusToFitLine(line, r);
    if (true === swapping) {
      fittedRadius /= 2;
    }
    cloud.push(cloudALine(line, fittedRadius, inward, swapping));
  }

  // SVG complains about empty path strings
  return 0 === cloud.length ? 'M0,0' : cloud.join(' ').trim();
};

module.exports = svgCloud;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJkZW1vL2luZGV4LmpzIiwic3JjL2RlY29yYXRvci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7Ozs7OztBQUVBLElBQU0sT0FBTyxTQUFTLGFBQVQsQ0FBdUIsV0FBdkIsQ0FBYjtBQUNBLElBQU0sU0FBUyxDQUNiO0FBQ0UsWUFBVSxTQURaO0FBRUUsVUFBUSxDQUFDLENBQUMsRUFBRCxFQUFLLEdBQUwsQ0FBRCxFQUFZLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBWixFQUF3QixDQUFDLEdBQUQsRUFBTSxHQUFOLENBQXhCO0FBRlYsQ0FEYSxFQUtiO0FBQ0UsWUFBVSxTQURaO0FBRUUsVUFBUSxDQUFDLENBQUMsRUFBRCxFQUFLLEdBQUwsQ0FBRCxFQUFZLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBWixFQUF5QixDQUFDLEdBQUQsRUFBTSxHQUFOLENBQXpCLEVBQXFDLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBckMsRUFBaUQsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUFqRCxFQUNDLENBQUMsRUFBRCxFQUFLLEdBQUwsQ0FERDtBQUZWLENBTGEsRUFVYjtBQUNFLFlBQVUsU0FEWjtBQUVFLFVBQVEsQ0FBQyxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQUQsRUFBYSxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQWIsRUFBeUIsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUF6QjtBQUZWLENBVmEsRUFjYjtBQUNFLFlBQVUsU0FEWjtBQUVFLFVBQVEsQ0FBQyxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQUQsRUFBYSxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQWIsRUFBeUIsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUF6QixFQUFxQyxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQXJDLEVBQWlELENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBakQsRUFD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biBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHN2Z0Nsb3VkIGZyb20gJy4uL3NyYy9kZWNvcmF0b3InO1xuXG5jb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyb2xzJyk7XG5jb25zdCBjbG91ZHMgPSBbXG4gIHtcbiAgICBzZWxlY3RvcjogJyNjbG91ZDEnLFxuICAgIGNvb3JkczogW1sxMCwgMTIwXSwgWzE4MCwgMTIwXSwgWzIzMCwgMTgwXV1cbiAgfSxcbiAge1xuICAgIHNlbGVjdG9yOiAnI2Nsb3VkMicsXG4gICAgY29vcmRzOiBbWzIwLCAzMDBdLCBbMTgwLCAzMDBdLCAgWzIwMCwgMzMwXSwgWzE5MCwgMzYwXSwgWzE0MCwgNDIwXSxcbiAgICAgICAgICAgICBbNzAsIDM4MF1dXG4gIH0sXG4gIHtcbiAgICBzZWxlY3RvcjogJyNjbG91ZDMnLFxuICAgIGNvb3JkczogW1s0NjAsIDEyMF0sIFsyOTAsIDEyMF0sIFsyNDAsIDE4MF1dXG4gIH0sXG4gIHtcbiAgICBzZWxlY3RvcjogJyNjbG91ZDQnLFxuICAgIGNvb3JkczogW1s0NTAsIDMwMF0sIFsyOTAsIDMwMF0sIFsyNzAsIDMzMF0sIFsyODAsIDM2MF0sIFszMzAsIDQyMF0sXG4gICAgICAgICAgICAgWzQwMCwgMzgwXV1cbiAgfSxcbiAge1xuICAgIHNlbGVjdG9yOiAnI2Nsb3VkX2wxJyxcbiAgICBjb29yZHM6IFtbMTAsIDEwXSwgWzIzMCwgMTBdXVxuICB9LFxuICB7XG4gICAgc2VsZWN0b3I6ICcjY2xvdWRfbDInLFxuICAgIGNvb3JkczogW1s0NTAsIDEwXSwgWzI0MCwgMTBdXVxuICB9XG5dO1xuXG5cbmNvbnN0IHJlbmRlciA9ICgpID0+IHtcbiAgbGV0IGVsZW07XG4gIGxldCBjbG91ZDtcbiAgY29uc3QgcmFkaXVzID0gcGFyc2VGbG9hdChmb3JtLnJhZGl1cy52YWx1ZSk7XG4gIGNvbnN0IGNsb3NlZCA9IGZvcm0uY2xvc2VkLmNoZWNrZWQ7XG4gIGNvbnN0IGlud2FyZCA9IGZvcm0uaW53YXJkLmNoZWNrZWQ7XG4gIGNvbnN0IHN3YXBwaW5nID0gZm9ybS5zd2FwcGluZy5jaGVja2VkO1xuXG4gIGZvciAobGV0IGluZCA9IDAsIGNudCA9IGNsb3Vkcy5sZW5ndGg7IGluZCA8IGNudDsgKytpbmQpIHtcbiAgICBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihjbG91ZHNbaW5kXS5zZWxlY3Rvcik7XG4gICAgY2xvdWQgPSBzdmdDbG91ZChjbG91ZHNbaW5kXS5jb29yZHMsIHJhZGl1cywgY2xvc2VkLCBpbndhcmQsXG4gICAgICBzd2FwcGluZyk7XG4gICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2QnLCBjbG91ZCk7XG4gIH1cbn07XG5cbmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVyKTtcbnJlbmRlcigpO1xuIiwiLyoqXG4gKiBHZW5lcmF0ZXMgc3ZnIGNsb3VkIGZvciBwb2x5Z29uXG4gKlxuICogQHBhcmFtICB7UG9seWdvbn0gcG9seWdvblxuICpcbiAqIEByZXR1cm4ge1NWRyBQYXRofVxuICovXG5cbmNvbnN0IFggPSAwO1xuY29uc3QgWSA9IDE7XG5jb25zdCBGTE9BVF9QUkVDSVNFID0gMC4wMDAwMDE7XG5cblxuY29uc3QgbGluZUxlbmd0aCA9IChsaW5lKSA9PiB7XG4gIGNvbnN0IHBvaW50QSA9IGxpbmVbMF07XG4gIGNvbnN0IHBvaW50QiA9IGxpbmVbMV07XG5cbiAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdygocG9pbnRCW1hdIC0gcG9pbnRBW1hdKSwgMikgK1xuICAgIE1hdGgucG93KChwb2ludEJbWV0gLSBwb2ludEFbWV0pLCAyKSk7XG59O1xuXG5cbmNvbnN0IGdldEludGVyc2VjdGlvbiA9IChsaW5lLCBsZW5ndGgpID0+IHtcbiAgbGV0IHBvaW50QyA9IG51bGw7XG4gIGNvbnN0IHBvaW50QSA9IGxpbmVbMF07XG4gIGNvbnN0IHBvaW50QiA9IGxpbmVbMV07XG4gIGxldCBkZWx0YTtcbiAgbGV0IHhQb2ludDtcbiAgbGV0IHlQb2ludDtcbiAgY29uc3QgZnVsbExlbiA9IGxpbmVMZW5ndGgobGluZSk7XG5cbiAgaWYgKE1hdGguYWJzKGZ1bGxMZW4gLSBsZW5ndGgpIDwgRkxPQVRfUFJFQ0lTRSkge1xuICAgIHBvaW50QyA9IHBvaW50QjtcbiAgfSBlbHNlIGlmIChmdWxsTGVuID4gbGVuZ3RoKSB7XG4gICAgZGVsdGEgPSBsZW5ndGggLyAoZnVsbExlbiAtIGxlbmd0aCk7XG4gICAgeFBvaW50ID0gKHBvaW50QVtYXSArIGRlbHRhICogcG9pbnRCW1hdKSAvICgxICsgZGVsdGEpO1xuICAgIHlQb2ludCA9IChwb2ludEFbWV0gKyBkZWx0YSAqIHBvaW50QltZXSkgLyAoMSArIGRlbHRhKTtcbiAgICBwb2ludEMgPSBbeFBvaW50LCB5UG9pbnRdO1xuICB9XG5cbiAgcmV0dXJuIHBvaW50Qztcbn07XG5cblxuY29uc3QgY2xvdWRBTGluZSA9IChsaW5lLCByYWRpdXMsIGlud2FyZCwgc3dhcHBpbmcpID0+IHtcbiAgbGV0IHBvaW50ID0gZ2V0SW50ZXJzZWN0aW9uKGxpbmUsIHJhZGl1cyAqIDIpO1xuICBsZXQgcmVtYWluaW5nTGluZSA9IGxpbmU7XG4gIGxldCBhcmM7XG4gIGNvbnN0IGNsb3VkID0gW2BNJHtsaW5lWzBdW1hdfSwke2xpbmVbMF1bWV19YF07XG4gIGxldCBzd2VlcCA9IHRydWUgPT09IGlud2FyZCA/IDAgOiAxO1xuICBsZXQgbEFyYyA9IHRydWUgPT09IGlud2FyZCA/IDAgOiAxO1xuXG4gIHdoaWxlIChwb2ludCkge1xuICAgIGFyYyA9IGAgQSR7cmFkaXVzfSwke3JhZGl1c30gMCAke2xBcmN9LCR7c3dlZXB9ICR7cG9pbnRbWF19LCR7cG9pbnRbWV19YDtcbiAgICBjbG91ZC5wdXNoKGFyYyk7XG4gICAgcmVtYWluaW5nTGluZSA9IFtwb2ludCwgcmVtYWluaW5nTGluZVsxXV07XG4gICAgcG9pbnQgPSBnZXRJbnRlcnNlY3Rpb24ocmVtYWluaW5nTGluZSwgcmFkaXVzICogMik7XG4gICAgaWYgKHRydWUgPT09IHN3YXBwaW5nKSB7XG4gICAgICBzd2VlcCBePSAxO1xuICAgICAgbEFyYyBePSAxO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjbG91ZC5qb2luKCcnKTtcbn07XG5cblxuY29uc3QgZml4UmFkaXVzVG9GaXRMaW5lID0gKGxpbmUsIHJhZGl1cykgPT4ge1xuICBjb25zdCBsZW5ndGggPSBsaW5lTGVuZ3RoKGxpbmUpO1xuICBjb25zdCBzZWdtZW50cyA9IE1hdGgucm91bmQobGVuZ3RoIC8gKDIgKiByYWRpdXMpICsgMC41KTtcblxuICByZXR1cm4gMCA8IGxlbmd0aCA/IGxlbmd0aCAvIHNlZ21lbnRzIC8gMiA6IHJhZGl1cztcbn07XG5cblxuY29uc3Qgc3ZnQ2xvdWQgPSAocG9seWxpbmUsIHJhZGl1cywgY2xvc2VkLCBpbndhcmQsIHN3YXBwaW5nKSA9PiB7XG4gIGxldCBjbG91ZCA9IFtdO1xuICBsZXQgaW5kID0gMTtcbiAgbGV0IGxpbmU7XG4gIGNvbnN0IHIgPSAwIDwgcmFkaXVzID8gcmFkaXVzIDogMTtcbiAgY29uc3QgY250ID0gcG9seWxpbmUubGVuZ3RoO1xuICBsZXQgZml0dGVkUmFkaXVzO1xuXG4gIGZvciAoOyBpbmQgPCBjbnQ7ICsraW5kKSB7XG4gICAgbGluZSA9IFtwb2x5bGluZVtpbmQgLSAxXSwgcG9seWxpbmVbaW5kXV07XG4gICAgZml0dGVkUmFkaXVzID0gZml4UmFkaXVzVG9GaXRMaW5lKGxpbmUsIHIpO1xuICAgIGlmICh0cnVlID09PSBzd2FwcGluZykge1xuICAgICAgZml0dGVkUmFkaXVzIC89IDI7XG4gICAgfVxuICAgIGNsb3VkLnB1c2goY2xvdWRBTGluZShsaW5lLCBmaXR0ZWRSYWRpdXMsIGlud2FyZCwgc3dhcHBpbmcpKTtcbiAgfVxuXG4gIC8vIGNsb3NlIHRvIGdldCBwb2x5Z29uXG4gIGlmICh0cnVlID09PSBjbG9zZWQgJiYgMSA8IGNudCkge1xuICAgIGxpbmUgPSBbcG9seWxpbmVbaW5kIC0gMV0sIHBvbHlsaW5lWzBdXTtcbiAgICBmaXR0ZWRSYWRpdXMgPSBmaXhSYWRpdXNUb0ZpdExpbmUobGluZSwgcik7XG4gICAgaWYgKHRydWUgPT09IHN3YXBwaW5nKSB7XG4gICAgICBmaXR0ZWRSYWRpdXMgLz0gMjtcbiAgICB9XG4gICAgY2xvdWQucHVzaChjbG91ZEFMaW5lKGxpbmUsIGZpdHRlZFJhZGl1cywgaW53YXJkLCBzd2FwcGluZykpO1xuICB9XG5cbiAgLy8gU1ZHIGNvbXBsYWlucyBhYm91dCBlbXB0eSBwYXRoIHN0cmluZ3NcbiAgcmV0dXJuIDAgPT09IGNsb3VkLmxlbmd0aCA/ICdNMCwwJyA6IGNsb3VkLmpvaW4oJyAnKS50cmltKCk7XG59O1xuXG5cbm1vZHVsZS5leHBvcnRzID0gc3ZnQ2xvdWQ7XG4iXX0=
